
# This file was generated by the Tkinter Designer by Parth Jadhav
# https://github.com/ParthJadhav/Tkinter-Designer


from pathlib import Path

# from tkinter import *
# Explicit imports to satisfy Flake8
from tkinter import Tk, Canvas, Button, PhotoImage, messagebox, filedialog, END
import os
from tkinter import filedialog
from tkinter import messagebox
from globals import selected_image_path, selected_folder_images, user_session  
import mysql.connector


OUTPUT_PATH = Path(__file__).parent
ASSETS_PATH = OUTPUT_PATH / Path(r"C:\Users\FPTSHOP\Downloads\PAC-ART-Project-main\PAC-ART-Project-main\Tkinter-Designer-master\Build\assets\frame2")


def relative_to_assets(path: str) -> Path:
    return ASSETS_PATH / Path(path)

def link():
    window.destroy()
    import Profile
    Profile.create_menu_window()


def logout():
    # Ask the user for confirmation
    response = messagebox.askyesno("Confirmation", "Are you sure you want to logout?")
    
    # If user clicks "Yes", proceed to destroy the current window and go back to Menu
    if response:
        window.destroy()
        import SignIn
        SignIn.create_menu_window()


def addimage():
    global selected_image_path
    try:
        # Hiển thị hộp thoại chọn tệp
        selected_image_path = filedialog.askopenfilename(
            title="Select an Image",
            filetypes=[("Image Files", "*.png;*.jpg;*.jpeg;*.gif;*.jfif")]
        )
        
        if selected_image_path:
            # Lấy tên ảnh từ đường dẫn
            name_image = os.path.basename(selected_image_path)

            # Kết nối tới cơ sở dữ liệu
            db = mysql.connector.connect(
                host='localhost',
                user='root',
                password='Thang23122004',
                database='pac_art'
            )
            cursor = db.cursor()

            # Kiểm tra xem ảnh đã tồn tại trong cơ sở dữ liệu chưa
            check_sql = "SELECT COUNT(*) FROM image WHERE name_image = %s"
            cursor.execute(check_sql, (name_image,))
            exists = cursor.fetchone()[0]

            if exists > 0:
                # Nếu ảnh đã tồn tại, không thêm vào database
                print(f"Image '{name_image}' already exists in the database.")
            else:
                # Đọc dữ liệu ảnh dưới dạng nhị phân
                with open(selected_image_path, 'rb') as file:
                    image_data = file.read()

                # Lệnh INSERT vào bảng image
                sql = "INSERT INTO image (name_image, image_data, user_id) VALUES (%s, %s, %s)"
                values = (name_image, image_data, user_session.user_id)
                cursor.execute(sql, values)
                db.commit()
                print("Image added to database successfully.")

            # Đóng kết nối
            cursor.close()
            db.close()

            # Chuyển tới giao diện chính và hiển thị ảnh
            window.destroy()
            from Function import create_menu_window
            create_menu_window(selected_image_path)
        else:
            messagebox.showinfo("No Images", "Please select an image to proceed.")
    
    except Exception as e:
        print(f"Error selecting image: {e}")


def addfolder():
    global selected_folder_images
    folder_path = filedialog.askdirectory(title="Select a Folder")
    if folder_path:
        image_extensions = ['.png', '.jpg', '.jpeg', '.gif', '.jfif']
        selected_folder_images = [os.path.join(folder_path, f) for f in os.listdir(folder_path)
                                  if os.path.splitext(f)[1].lower() in image_extensions]
        if selected_folder_images:
            print(f"Images found: {selected_folder_images}")  # Debug output
            window.destroy()
            from Function import create_menu_window  # Avoid circular import
            create_menu_window(folder_images=selected_folder_images)
        else:
            messagebox.showinfo("No Images", "No images found in the selected folder.")
    else:
        messagebox.showinfo("No Folder Selected", "Please select a folder to proceed.")


def create_menu_window(image_path=None, folder_images=None):
    global window
    window = Tk()

    window.geometry("1000x600")
    window.configure(bg = "#E7F9F1")
    window.title("Pac Art")


    canvas = Canvas(
        window,
        bg = "#EDEDED",
        height = 600,
        width = 1000,
        bd = 0,
        highlightthickness = 0,
        relief = "ridge"
    )

    canvas.place(x = 0, y = 0)
    canvas.create_rectangle(
        0.0,
        0.0,
        1000.0,
        110.0,
        fill="#1F92E5",
        outline="")

    image_image_1 = PhotoImage(
        file=relative_to_assets("image_1.png"))
    image_1 = canvas.create_image(
        90.0,
        54.0,
        image=image_image_1
    )

    canvas.create_text(
        390.0,
        17.0,
        anchor="nw",
        text="PAC ART",
        fill="#FFFFFF",
        font=("Fredericka the Great", 64 * -1)
    )

    button_image_1 = PhotoImage(
        file=relative_to_assets("button_1.png"))
    Addimage = Button(
        image=button_image_1,
        borderwidth=0,
        highlightthickness=0,
        command=addimage,
        relief="flat"
    )
    Addimage.place(
        x=225.0,
        y=226.0,
        width=200.0,
        height=246.0
    )

    button_image_2 = PhotoImage(
        file=relative_to_assets("button_2.png"))
    Addfolder = Button(
        image=button_image_2,
        borderwidth=0,
        highlightthickness=0,
        command=addfolder,
        relief="flat"
    )
    Addfolder.place(
        x=576.0,
        y=226.0,
        width=200.0,
        height=246.0
    )

    button_image_3 = PhotoImage(
        file=relative_to_assets("button_3.png"))
    button_3 = Button(
        image=button_image_3,
        borderwidth=0,
        highlightthickness=0,
        command=link,
        relief="flat"
    )
    button_3.place(
        x=939.0,
        y=30.0,
        width=50.0,
        height=50.0
    )

    button_image_4 = PhotoImage(
        file=relative_to_assets("button_4.png"))
    Logout = Button(
        image=button_image_4,
        borderwidth=0,
        highlightthickness=0,
        command=logout,
        relief="flat"
    )
    Logout.place(
        x=878.0,
        y=30.0,
        width=50.0,
        height=50.0
    )
    window.resizable(False, False)
    window.mainloop()

# # Main application logic wrapped under if __name__ == "__main__"
# if __name__ == "__main__":
#     create_menu_window()  # Start the application with the menu window